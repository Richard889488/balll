<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebUSB 與 Arduino 通信</title>
</head>
<body>
    <h1>WebUSB 與 Arduino 通信</h1>
    <button id="connect">連接 Arduino</button>
    <button id="sendData">傳送數據</button>
    <textarea id="output" rows="10" cols="50" readonly></textarea>

    <script>
        let device;

        // 連接到 Arduino
        document.getElementById('connect').addEventListener('click', async () => {
            try {
                // 請求使用者選擇 USB 設備
                device = await navigator.usb.requestDevice({
                    filters: [{ vendorId: 0x2341 }] // Arduino 的 Vendor ID（根據設備可調整）
                });

                await device.open(); // 打開 USB 設備
                await device.selectConfiguration(1); // 設置配置
                await device.claimInterface(0); // 聲明接口

                console.log("成功連接到 Arduino！");
            } catch (error) {
                console.error("連接 Arduino 失敗: ", error);
            }
        });

        // 傳送數據到 Arduino
        document.getElementById('sendData').addEventListener('click', async () => {
            if (device) {
                try {
                    const encoder = new TextEncoder();
                    const data = encoder.encode("Hello Arduino\n");
                    await device.transferOut(4, data); // Endpoint 4 用於數據傳輸
                    console.log("數據已傳送: Hello Arduino");
                } catch (error) {
                    console.error("傳送數據失敗: ", error);
                }
            } else {
                console.log("尚未連接 Arduino！");
            }
        });
    </script>
</body>
</html>
